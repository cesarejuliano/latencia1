<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lat√™ncia | Dois viol√µes</title>
    <link rel="stylesheet" href="css/style.css" />
    <meta property="og:title" content="Dois Viol√µes ‚Äî Lat√™ncia" />
    <meta property="og:description" content="Epis√≥dio da s√©rie Lat√™ncia por C√©sar & Juliano." />
    <meta property="og:image" content="https://cesarejuliano.github.io/latencia1/thumbs/index-previa.jpg" />
    <meta property="og:url" content="https://cesarejuliano.github.io/latencia1/encavalada.html" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
  </head>
  <body class="fade-in">
    <div class="encavalada-background">
      <img src="imagens/mondrian.jpg" alt="Fundo Encavalada" />
    </div>

    <nav class="menu">
      <button id="menu-toggle">‚ò∞</button>
      <ul id="menu-items">
        <li><a href="index.html">Epis√≥dios</a></li>
        <li><a href="latencia.html">Lat√™ncia</a></li>
        <li><a href="duo.html">C√©sar & Juliano</a></li>
      </ul>
    </nav>
    <!--
    <main class="conteudo-ninfas">
      <div class="audio-container">
        <button id="playButton">‚ñ∂Ô∏è</button>
        <button id="swapButton" style="display:none">üé≠</button>
      </div>
    </main>-->
    <main class="audio-container" style="position: relative;">
      <button id="playButton">‚ñ∂Ô∏è</button>
      <!--<div id="info">
        <p id="c-info">C:</p>
        <p id="j-info">J:</p>
      </div>-->
      <button id="swapButton">üé≠</button>
    </main>

    <script>
      const cAudios = ['c1.mp3', 'c2.mp3', 'c3.mp3', 'c4.mp3', 'c5.mp3'];
      const jAudios = ['j1.mp3', 'j2.mp3', 'j3.mp3', 'j4.mp3', 'j5.mp3'];

      // Dura√ß√µes dos √°udios em segundos, para controle de currentTime
      const durations = {
        'c1.mp3': 84, 'j1.mp3': 92,
        'c2.mp3': 43, 'j2.mp3': 47,
        'c3.mp3': 76, 'j3.mp3': 68,
        'c4.mp3': 40, 'j4.mp3': 68,
        'c5.mp3': 217,'j5.mp3': 184
      };

      let currentCIndex = null;
      let currentJIndex = null;
      let audioC = new Audio();
      let audioJ = new Audio();
      audioC.volume = 1;
      audioJ.volume = 1;

      const playButton = document.getElementById('playButton');
      const swapButton = document.getElementById('swapButton');
      const cInfo = document.getElementById('c-info');
      const jInfo = document.getElementById('j-info');

      // Fun√ß√£o para atualizar texto dos √°udios atuais
      function updateInfo() {
        cInfo.textContent = `C: ${cAudios[currentCIndex]}`;
        jInfo.textContent = `J: ${jAudios[currentJIndex]}`;
      }

      // Sorteia √≠ndice diferente do atual
      function getRandomIndex(excludeIndex, max) {
        let idx;
        do {
          idx = Math.floor(Math.random() * max);
        } while (idx === excludeIndex);
        return idx;
      }

      // Define um tempo aleat√≥rio entre 0 e 70% da dura√ß√£o do √°udio
      function randomStartTime(duration) {
        return Math.random() * duration * 0.7;
      }

      // Posiciona o bot√£o swap em local aleat√≥rio longe do play
      function positionSwapButton() {
        const container = document.querySelector('.audio-container');
        const rect = container.getBoundingClientRect();
        const btnWidth = 50; // aprox width do bot√£o em px
        const btnHeight = 50; // aprox height do bot√£o

        // Para evitar sobreposi√ß√£o no centro, limita posi√ß√£o
        const x = Math.random() * (rect.width - btnWidth);
        const y = Math.random() * (rect.height - btnHeight);
        swapButton.style.left = `${x}px`;
        swapButton.style.top = `${y}px`;
      }

      // Tocar par de √°udios c e j, come√ßando do in√≠cio ou pontos aleat√≥rios at√© 70%
      function playPair(cIndex = null) {
        if (cIndex === null) {
          cIndex = Math.floor(Math.random() * cAudios.length);
        }
        currentCIndex = cIndex;
        currentJIndex = cIndex; // √≠ndice igual para o par

        audioC.src = `audios/${cAudios[currentCIndex]}`;
        audioJ.src = `audios/${jAudios[currentJIndex]}`;

        audioC.currentTime = randomStartTime(durations[cAudios[currentCIndex]]);
        audioJ.currentTime = randomStartTime(durations[jAudios[currentJIndex]]);

        updateInfo();

        audioC.play();
        audioJ.play();

        // Quando terminar C, toca outro C automaticamente
        audioC.onended = () => {
          const nextCIndex = getRandomIndex(currentCIndex, cAudios.length);
          currentCIndex = nextCIndex;
          audioC.src = `audios/${cAudios[currentCIndex]}`;
          audioC.currentTime = randomStartTime(durations[cAudios[currentCIndex]]);
          updateInfo();
          audioC.play();
        };

        // Quando terminar J, toca outro J automaticamente (com mesmo √≠ndice do C atual)
        audioJ.onended = () => {
          currentJIndex = currentCIndex; // mant√©m √≠ndice sincronizado com C
          audioJ.src = `audios/${jAudios[currentJIndex]}`;
          audioJ.currentTime = randomStartTime(durations[jAudios[currentJIndex]]);
          updateInfo();
          audioJ.play();
        };
      }

      // Mostrar o bot√£o de swap pela primeira vez s√≥ depois de 60-80 segundos
      function showSwapButtonAfterDelay() {
        const delayMs = (60 + Math.random() * 20) * 1000; // 60 a 80s
        setTimeout(() => {
          positionSwapButton();
          swapButton.style.display = 'block';
        }, delayMs);
      }

      // Trocar pares ao clicar no bot√£o swap
      swapButton.addEventListener('click', () => {
        const newCIndex = getRandomIndex(currentCIndex, cAudios.length);
        playPair(newCIndex);
        positionSwapButton();
        swapButton.style.display = 'none'; // esconde at√© aparecer de novo
        showSwapButtonAfterDelay();
      });

      // Ao clicar no play, inicia o som e programa o swapButton
      playButton.addEventListener('click', () => {
        playPair();
        playButton.style.display = 'none';
        showSwapButtonAfterDelay();
      });
    </script>


  </body>
</html>
