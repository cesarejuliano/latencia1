<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LatÃªncia | Dois violÃµes</title>
    <link rel="stylesheet" href="css/style.css" />
    <meta property="og:title" content="Dois ViolÃµes â€” LatÃªncia" />
    <meta property="og:description" content="EpisÃ³dio da sÃ©rie LatÃªncia por CÃ©sar & Juliano." />
    <meta property="og:image" content="https://cesarejuliano.github.io/latencia1/thumbs/index-previa.jpg" />
    <meta property="og:url" content="https://cesarejuliano.github.io/latencia1/encavalada.html" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
  </head>
  <body class="fade-in">
    <div class="encavalada-background">
      <img src="imagens/mondrian.jpg" alt="Fundo Encavalada" />
    </div>

    <nav class="menu">
      <button id="menu-toggle">â˜°</button>
      <ul id="menu-items">
        <li><a href="index.html">EpisÃ³dios</a></li>
        <li><a href="latencia.html">LatÃªncia</a></li>
        <li><a href="duo.html">CÃ©sar & Juliano</a></li>
      </ul>
    </nav>
    <!--
    <main class="conteudo-ninfas">
      <div class="audio-container">
        <button id="playButton">â–¶ï¸</button>
        <button id="swapButton" style="display:none">ğŸ­</button>
      </div>
    </main>-->
    <main class="audio-container">
      <button id="playButton">â–¶ï¸</button>
      <!--<div id="info">
        <p id="c-info">C:</p>
        <p id="j-info">J:</p>
      </div>-->
      <button id="swapButton">ğŸ­</button>
    </main>

    <script>
      const cAudios = ['c1.mp3', 'c2.mp3', 'c3.mp3', 'c4.mp3', 'c5.mp3'];
      const jAudios = ['j1.mp3', 'j2.mp3', 'j3.mp3', 'j4.mp3', 'j5.mp3'];

      // DuraÃ§Ãµes dos Ã¡udios em segundos, para controle de currentTime
      const durations = {
        'c1.mp3': 84, 'j1.mp3': 92,
        'c2.mp3': 43, 'j2.mp3': 47,
        'c3.mp3': 76, 'j3.mp3': 68,
        'c4.mp3': 40, 'j4.mp3': 68,
        'c5.mp3': 217,'j5.mp3': 184
      };

      let currentCIndex = null;
      let currentJIndex = null;
      let audioC = new Audio();
      let audioJ = new Audio();
      audioC.volume = 1;
      audioJ.volume = 1;

      const playButton = document.getElementById('playButton');
      const swapButton = document.getElementById('swapButton');
      // const cInfo = document.getElementById('c-info');
      // const jInfo = document.getElementById('j-info');

      // FunÃ§Ã£o para atualizar texto dos Ã¡udios atuais
      function updateInfo() {
        // cInfo.textContent = `C: ${cAudios[currentCIndex]}`;
        // jInfo.textContent = `J: ${jAudios[currentJIndex]}`;
      }

      // Sorteia Ã­ndice diferente do atual
      function getRandomIndex(excludeIndex, max) {
        let idx;
        do {
          idx = Math.floor(Math.random() * max);
        } while (idx === excludeIndex);
        return idx;
      }

      // Define um tempo aleatÃ³rio entre 0 e 70% da duraÃ§Ã£o do Ã¡udio
      function randomStartTime(duration) {
        return Math.random() * duration * 0.7;
      }

      // Posiciona o botÃ£o swap em local aleatÃ³rio longe do play
      function positionSwapButton() {
        const container = document.querySelector('.audio-container');
        const rect = container.getBoundingClientRect();
        const btnWidth = 50; // aprox width do botÃ£o em px
        const btnHeight = 50; // aprox height do botÃ£o

        // Para evitar sobreposiÃ§Ã£o no centro, limita posiÃ§Ã£o
        const x = Math.random() * (rect.width - btnWidth);
        const y = Math.random() * (rect.height - btnHeight);
        swapButton.style.left = `${x}px`;
        swapButton.style.top = `${y}px`;
      }

      // Tocar par de Ã¡udios c e j, comeÃ§ando do inÃ­cio ou pontos aleatÃ³rios atÃ© 70%
      function playPair(cIndex = null) {
        if (cIndex === null) {
          cIndex = Math.floor(Math.random() * cAudios.length);
        }
        currentCIndex = cIndex;
        currentJIndex = cIndex; // Ã­ndice igual para o par

        audioC.src = `audios/${cAudios[currentCIndex]}`;
        audioJ.src = `audios/${jAudios[currentJIndex]}`;

        audioC.currentTime = randomStartTime(durations[cAudios[currentCIndex]]);
        audioJ.currentTime = randomStartTime(durations[jAudios[currentJIndex]]);

        updateInfo();

        audioC.play();
        audioJ.play();

        // Quando terminar C, toca outro C automaticamente
        audioC.onended = () => {
          const nextCIndex = getRandomIndex(currentCIndex, cAudios.length);
          currentCIndex = nextCIndex;
          audioC.src = `audios/${cAudios[currentCIndex]}`;
          audioC.currentTime = randomStartTime(durations[cAudios[currentCIndex]]);
          updateInfo();
          audioC.play();
        };

        // Quando terminar J, toca outro J automaticamente (com mesmo Ã­ndice do C atual)
        audioJ.onended = () => {
          currentJIndex = currentCIndex; // mantÃ©m Ã­ndice sincronizado com C
          audioJ.src = `audios/${jAudios[currentJIndex]}`;
          audioJ.currentTime = randomStartTime(durations[jAudios[currentJIndex]]);
          updateInfo();
          audioJ.play();
        };
      }

      // Mostrar o botÃ£o de swap pela primeira vez sÃ³ depois de 60-80 segundos
      function showSwapButtonAfterDelay() {
        const delayMs = (60 + Math.random() * 20) * 1000; // 60 a 80s
        setTimeout(() => {
          positionSwapButton();
          swapButton.style.display = 'block';
        }, delayMs);
      }

      // Trocar pares ao clicar no botÃ£o swap
      swapButton.addEventListener('click', () => {
        const newCIndex = getRandomIndex(currentCIndex, cAudios.length);
        playPair(newCIndex);
        positionSwapButton();
        swapButton.style.display = 'none'; // esconde atÃ© aparecer de novo
        showSwapButtonAfterDelay();
      });

      // Ao clicar no play, inicia o som e programa o swapButton
      playButton.addEventListener('click', () => {
        playPair();
        playButton.style.display = 'none';
        showSwapButtonAfterDelay();
      });
      
      const toggle = document.getElementById("menu-toggle");
      const items = document.getElementById("menu-items");
      toggle?.addEventListener("click", () => {
        items.classList.toggle("active");
      });
    </script>

  </body>
</html>
